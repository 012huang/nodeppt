!function(a,b){var c=function(){},h=navigator.userAgent,f=~h.indexOf("AppleWebKit"),k=b.head||b.getElementsByTagName("head")[0]||b.documentElement;function e(o,r,q,n){if(typeof n!=="boolean"){n=/\.css(?:\?|$)/i.test(o)}var p=b.createElement(n?"link":"script");typeof r==="function"&&m(p,r);o=d(o);if(n){p.rel="stylesheet";p.href=o;k.appendChild(p)}else{p.async="async";p.src=o;q=q||"UTF-8";p.type="text/javascript";p.charset=q;k.insertBefore(p,k.firstChild)}}function m(o,q){if(o.nodeName==="SCRIPT"){g(o,n)}else{l(o,n)}var p=setTimeout(function(){n()},20000);function n(){if(!n.isCalled){n.isCalled=true;clearTimeout(p);q()}}}function j(s){s=s.replace(/([^:\/])\/+/g,"$1/");if(s.indexOf(".")===-1){return s}var o=s.split("/");var q=[],p,r=0,n=o.length;for(;r<n;r++){p=o[r];if(p===".."){if(q.length===0){throw new Error("realpath: url为空")}q.pop()}else{if(p!=="."){q.push(p)}}}return q.join("/")}function d(n){n=j(n);if(/#$/.test(n)){n=n.slice(0,-1)}else{if(n.indexOf("?")===-1&&!/\.(?:css|js)$/.test(n)){n+=".js"}}return n}function g(n,o){n.onload=n.onerror=n.onreadystatechange=function(){if(/loaded|complete|undefined/.test(n.readyState)){n.onload=n.onerror=n.onreadystatechange=null;if(n.parentNode){try{if(n.clearAttributes){n.clearAttributes()}else{for(var r in n){delete n[r]}}}catch(q){}k.removeChild(n)}n=undefined;o()}}}function l(n,o){if(n.attachEvent){n.attachEvent("onload",o)}else{setTimeout(function(){i(n,o)},0)}}function i(o,q){if(q.isCalled){return}var n;if(f){if(o.sheet){n=true}}else{if(o.sheet){try{if(o.sheet.cssRules){n=true}}catch(p){if(p.code===1000){n=true}}}}setTimeout(function(){if(n){q()}else{i(o,q)}},1)}a.loadJS=function(n,p,o){e(n,p,o)};a.loadCSS=function(n,o){e(n,o,"utf-8",true)};a.load=e}(window,document);isControlDevice=typeof isControlDevice==="undefined"?false:isControlDevice;!function(v,V){var m,q=false,s="http://123.254.106.78:3000/"+(isControlDevice?"pptcontrol":"pptuser");var G=15;var B=V.body;var g="bind";var W=true;var b=0;var a=0;var N="html5和css3的爱情";var S=800;var k=0;var O=Q("progress");var e=Q("container");var i=p(C(".slide",e));var c=i.length;e.style.width=c*S+"px";c--;var aa=Q("canvasTop");function D(){O.style.width=((k+1)/(c+1))*100+"%"}function p(ac){return[].slice.call(ac)}function C(ac,ad){ad=(ad&&ad.nodeType===1)?ad:V;return ad.querySelectorAll(ac)}function Q(ac){return V.getElementById(ac)}function H(ad){var ac=ad.keyCode;switch(ac){case 80:r();break;case 67:X();break;case 33:case 37:case 38:(isControlDevice||g!=="bindAll")&&u();break;case 9:case 32:case 34:case 39:case 40:(isControlDevice||g!=="bindAll")&&F();break}}function u(){Z(i[k]);--k<0&&(k=0);l()}function F(){if(x()){q&&E({donext:k});return}Z(i[k]);++k>c&&(k=c);l();j(i[k])(i[k+1])}function M(){var ac=i[k];if(!ac||(ac&&ac.nodeType!==1)){return}ac.dataset.incallback&&typeof window[ac.dataset.incallback]==="function"&&ab(ac.dataset.incallback)}function Z(ac){if(!ac||(ac&&ac.nodeType!==1)){return}ac.dataset.outcallback&&typeof window[ac.dataset.outcallback]==="function"&&ab(ac.dataset.outcallback)}function j(ad){var ak=arguments.callee;if(ad&&ad.nodeType===1){var ag=C("preload",ad),ah=ag.length;while(ah--){var ae=ag[ah],af=ag[ah].dataset,ai=af.type,ac=af.url;var aj=v["load"+ai.toUpperCase()];typeof aj==="function"&&aj(ac,function(al){return function(){al.parentNode&&al.parentNode.removeChild(al);al=null}}(ae))}}return ak}function x(){var ac=C(".to-build",i[k]);if(!ac.length){return false}ac[0].classList.remove("to-build","");return true}function K(){var af=c,ac;while(ac=i[--af]){var ad=C(".build > *",ac);for(var ae=0,ag;ag=ad[ae];ae++){if(ag.classList){ag.classList.add("to-build")}}}}function l(ac){ac=ac||k;e.style.marginLeft=-(ac*S)+"px";D();q&&E({slideID:ac});W&&(v.location.hash="#"+ac);M();X()}function o(){try{if(q){q=false;m=io.connect(s);m.on("system",function(ad){q=true;t(ad.msg);if(ad.dowhat==="free"){g="bind"}});if(isControlDevice){m.on("server update",function(ad){Y(ad)});m.on("client handle",function(ad){if(ad.handleFnName&&typeof window[ad.handleFnName]==="function"){window[ad.handleFnName].call({},ad.args)}})}else{m.on("server order",function(ad){Y(ad)});m.on("server handle",function(ad){if(ad.handleFnName&&typeof window[ad.handleFnName]==="function"){window[ad.handleFnName].apply({},ad.args)}});m.on("server control message",function(ad){switch(ad.state){case"bind":g=ad.state;t("状态转化：目前是完全同步状态");break;case"unbind":g=ad.state;t("状态转化：目前是释放控制状态");break;case"bindAll":g=ad.state;t("状态转化：目前是完全控制状态");break}})}}}catch(ac){throw new Error("websocket connect error!")}}function f(ac){if(isControlDevice&&q&&m){g=ac;m.emit("server bind update",{state:ac});"bind bindAll unbind".replace(/\S+/g,function(ad){Q(ad).classList.remove("orange");if(ac===ad){Q(ac).classList.add("orange")}})}}function Y(ac){q=0;if(ac.donext&&k===ac.donext){F();q=1;return}k=ac.slideID;l();j(i[k])(i[k+1]);q=1}function t(ac){Q("slideTip").innerHTML=ac;Q("slideTip").style.display="block";setTimeout(function(){Q("slideTip").style.display="none"},3000)}function E(ac){if(q&&m&&g!=="unbind"){m.emit(isControlDevice?"order":"update",ac)}}function w(ad,ac){if(q&&m&&g!=="unbind"){m.emit(isControlDevice?"handle by server":"handle by client",{handleFnName:ad,args:ac})}}function y(){V.addEventListener("keyup",H,false);B.addEventListener("touchstart",d,false);!isControlDevice&&I();v.addEventListener("hashchange",function(){if(location.hash){W=false;Z(i[k]);k=location.hash.substr(1)|0;l();W=true}},true)}function I(){var ac=C(".helpBtn",Q("helpContainer"));if(ac[0]){ac[0].addEventListener("click",function(){var ad=Q("helpContainer").style;if(parseInt(ad.marginLeft,10)<0){ad.marginLeft=0}else{ad.marginLeft="-570px"}},true);Q("helpContainer").style.marginLeft="-570px"}}function R(){if(q){loadJS("js/socket.io.js",o)}K();y();if(location.hash&&(k=(location.hash.substr(1)|0))){l()}else{D();M()}j(i[k])(i[k+1])}function d(ac){if(ac.touches.length==1){b=0;a=0;touchStartX=ac.touches[0].pageX;touchStartY=ac.touches[0].pageY;B.addEventListener("touchmove",z,true);B.addEventListener("touchend",U,true)}}function z(ac){if(ac.touches.length>1){A()}else{b=ac.touches[0].pageX-touchStartX;a=ac.touches[0].pageY-touchStartY}}function U(ae){var ad=Math.abs(b);var ac=Math.abs(a);if((ad>G)&&(ac<(ad*2/3))){if(b>0){u()}else{F()}}A()}function A(){B.removeEventListener("touchmove",z,true);B.removeEventListener("touchend",U,true)}var P=Q("drawCanvas");P&&(P.style.display="none")&&(V.onselectstart=function(){return false});function n(){if(!P){return}P.context=P.getContext("2d");P.context.lineWidth=3;P.context.lineCap="round";P.context.strokeStyle="red"}function r(){if(!P){return}n();P.style.display="";P.addEventListener("mousedown",J,true);P.addEventListener("mouseup",L,true);P.addEventListener("mousemove",T,true)}function h(){if(!P){return}P.context&&P.context.clearRect(0,0,800,600);P.style.display="none"}var X=function(){if(!P){return}h();P.removeEventListener("mousedown",J);P.removeEventListener("mouseup",L);P.removeEventListener("mousemove",T)},J=function(ac){P.isMouseDown=true;P.iLastX=ac.layerX||ac.offsetX||(ac.clientX-P.offsetLeft+(v.pageXOffset||V.body.scrollLeft||V.documentElement.scrollLeft));P.iLastY=ac.layerY||ac.offsetY||(ac.clientY-P.offsetTop+(v.pageYOffset||V.body.scrollTop||V.documentElement.scrollTop))},L=function(){P.isMouseDown=false;P.iLastX=-1;P.iLastY=-1},T=function(ad){if(P.isMouseDown){var ac=ad.layerX||ad.offsetX||(ad.clientX-P.offsetLeft+(v.pageXOffset||V.body.scrollLeft||V.documentElement.scrollLeft));var ae=ad.layerY||ad.offsetY||(ad.clientY-P.offsetTop+(v.pageYOffset||V.body.scrollTop||V.documentElement.scrollTop));P.context.beginPath();P.context.moveTo(P.iLastX,P.iLastY);P.context.lineTo(ac,ae);P.context.stroke();P.iLastX=ac;P.iLastY=ae}};function ab(ad,ac){if(isControlDevice){q&&g!=="unbind"&&w(ad,ac)}else{if(typeof window[ad]==="function"){window[ad](ac)}}}R();v.slide={nextSlide:F,prevSlide:u,sendControlState:f,sendWebSoketOrder:w};v.proxyFn=ab}(window,document);